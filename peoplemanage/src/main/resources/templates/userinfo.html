<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>预测记录信息</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/layui/css/layui.css" media="all">
    <link rel="stylesheet" href="/css/font.css">
    <link rel="stylesheet" href="/css/xadmin.css">
    <script type="text/javascript" src="/js/xadmin.js"></script>
    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
</head>

<body>

<!--    <form class="layui-form" action="">
        <div class="layui-btn-group demoTable">
            <button type="submit" class="layui-btn" lay-submit="" lay-filter="recent1" onClick="return false">最近24小时</button>
            <button type="submit" class="layui-btn" lay-submit="" lay-filter="recent2" onClick="return false">最近7天</button>
            <button type="submit" class="layui-btn" lay-submit="" lay-filter="recent3" onClick="return false">最近1个月</button>
            <button type="submit" class="layui-btn" lay-submit="" lay-filter="recent4" onClick="return false">最近6个月</button>
            <button type="submit" class="layui-btn" lay-submit="" lay-filter="recent5" onClick="return false">最近1年</button>
            <button type="submit" class="layui-btn" lay-submit="" lay-filter="recent6" onClick="return false">全部</button>
        </div>
    </form> -->

<table id="disasterPredictionTb" lay-filter="disasterPredictionTb"></table>
<div style="margin-right: 10px;padding-right: 10px"><button type="button" class="layui-btn layui-btn-lg layui-btn-radius" style="position: absolute;right:50px;" id="dataUpdate">数据更新</button></div>


<script type="text/html" id="barDemo">
    <!-- <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a> -->

</script>

<script src="/layui/layui.js" charset="utf-8"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
<script>
    layui.use(['table', 'jquery'], function(){
        var table = layui.table;
        var $ = layui.jquery;
        //第一个实例
        table.render({
            elem: '#disasterPredictionTb',
            url: 'http://82.156.208.204:10003/v1/userInfo',
            page: true,
            toolbar: '#toolbarDemo',
            defaultToolbar: ['filter', 'exports', 'print'],
            cols: [
                [
                    //{type:'checkbox', fixed: 'left'},
                    {
                        field: 'id',
                        title: 'ID',
                        width: 350,
                        sort: true,
                        fixed: true
                    }, {
                    field: 'status',
                    title: '状态',
                    width: 180,
                    sort: true,
                    fixed: true,
                    templet:function(d){
                        if(d.status==0){
                            return '<span>正常</sapn>'
                        }else{
                            if(d.status==1){
                                return '<span>确诊</sapn>'
                            }else{
                                if(d.status==2){
                                    return '<span>密接</sapn>'
                                }
                                return '<span>次密接</sapn>'
                            }
                        }
                    }
                }, {
                    field: 'phoneNumber',
                    title: '电话号码',
                    width: 400
                }, {	//表格最后一栏如果是操作栏，可以删除和修改
                    field: 'opt',
                    minWidth: '50',
                    title: '操作',
                    style: 'text-align:center',
                    templet: function (d)
                    {
                        return '<button type="button" class="layui-btn layui-btn-sm layui-btn-radius" style="height: 25px" id="modify">修改</button>' +
                            '<button type="button" class="layui-btn layui-btn-sm layui-btn-radius layui-btn-danger" style="height: 25px" id="delete">删除</button>';
                    }
                }
                ]
            ]
        });
        $(document).on('click','#modify',function(){
            var that = this;
            layer.prompt({
                title:'修改状态(0-3)'
            }, function(val, index){
                var phoneNumber = $(that).parent().parent().prev().children().text();
                var user_id = $(that).parent().parent().prev().prev().prev().children().text();
                var status = val;
                console.log(val);
                layer.close(index);
                var user = {"id": user_id, "phoneNumber": phoneNumber, "status": status};
                console.log(user);
                $.ajax({
                    url: 'http://localhost:10002/v1/updateuserinfo',
                    type: "POST",
                    xhrFields: {
                        withCredentials: true //允许跨域认证
                    },
                    data: user,
                    success: function (data) {
                        $(".layui-laypage-btn")[0].click();
                    },
                    error: function (data) {
                    }
                })
            });
        });

        $(document).on('click','#delete',function(){
            var id = $(this).parent().parent().prev().prev().prev().children().text();
            var user = {id: id}
            console.log(id);
            layer.confirm('是否确定删除？', {
                btn: ['是','否'] //按钮
            }, function(){
                layer.msg('删除成功', {icon: 1});
                $.ajax({
                    url: 'http://localhost:10002/v1/deleteuserinfo',
                    type: "POST",
                    xhrFields: {
                        withCredentials: true //允许跨域认证
                    },
                    data: user,
                    success: function (data) {

                        $(".layui-laypage-btn")[0].click();
                    },
                    error: function (data) {
                    }
                })
            }, function(){

            });
        });
        $("#dataUpdate").click(function(){

            var that = this;
            console.log(1);
            layer.load(2);
            $.ajax({
                url: 'http://localhost:10002/v1/updateData',
                type: "GET",
                xhrFields: {
                    withCredentials: true //允许跨域认证
                },
                success: function (data) {
                    layer.closeAll('loading');
                },
                error: function (data) {
                }
            })

        });
    });

</script>
</body>

</html>